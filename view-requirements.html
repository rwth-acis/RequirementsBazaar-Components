<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-meta/iron-meta.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="elements/categories-menu.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="view-requirements-list.html">

<dom-module id="view-requirements">
  <style include="shared-styles">
    :host {
      display: inline-block;
    }

    app-toolbar {
      margin-top: 10px;
      height: 40px;
    }

    #categoriesContainer {
      @apply(--layout-flex);
      overflow: scroll;
    }

  </style>
  <template>

    <iron-ajax id="categoryRequest"
               loading="{{loading}}"
               content-type="application/json"
               url="[[_apiBaseUrl]]categories/[[categoryId]]"
               headers="[[authHeader]]"
               last-response="{{category}}"
               auto></iron-ajax>

    <div style="display: inline-block;">
      <paper-card style="float: left;" >
        <div id="categoriesContainer" class="card-content">
          <categories-menu id="categoriesMenu" project-id="[[projectId]]" category-id="{{categoryId}}" loading="{{loading}}"
                           view="{{view}}" categories="{{categories}}" authorized="{{authorized}}"
                           auth-token="{{authToken}}" current-user="{{currentUser}}">
          </categories-menu>
        </div>
      </paper-card>
      <view-requirements-list style="float: right;"  name="requirements-list" project-id="[[projectId]]" project="{{project}}"
                category-id="{{categoryId}}" category="{{category}}" view-option="{{view}}" loading="{{loading}}"
                authorized="{{authorized}}" auth-token="{{authToken}}" current-user="{{currentUser}}"></view-requirements-list>
    </div>

  </template>

  <script>
      class viewRequirements extends Polymer.Element {
          static get is() { return 'view-requirements'; }

          static get properties() {
              return {
                  _apiBaseUrl: {
                      type: String,
                      value: 'https://requirements-bazaar.org/bazaar/'
                  },
                  _fileApiBaseUrl: {
                      type: String,
                      value: 'https://requirements-bazaar.org/fileservice/files/'
                  },
                  currentUser: {
                      type: String
                  },
                  /**
                   * Defines whether the user is logged in or not.
                   */
                  authorized: {
                      type: Boolean,
                      value: false
                  },
                  authHeader: {
                      type: Array
                  },
                  authToken: {
                      type: String,
                      observer: '_authTokenChanged'
                  },
                  view: {
                      type: String,
                      notify: true
                  },
                  categoryId: {
                      type: Number,
                      notify: true
                  },
                  /**
                   * Whether any loading operation is currently active.
                   */
                  loading: {
                      type: Boolean,
                      notify: true
                  }
              };
          }

          constructor() {
              super();
          }

          _authTokenChanged(token) {
              this.authorized = true;
              this.authHeader = {authorization: "Bearer " + token};
          }
      }
      window.customElements.define(viewRequirements.is, viewRequirements);
  </script>
</dom-module>
